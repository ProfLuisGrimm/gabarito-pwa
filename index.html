<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Gabarito</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f9f9f9;
    }

    .tabs {
      display: flex;
      margin-bottom: 20px;
    }
    .tabs button {
      padding: 10px 20px;
      border: 1px solid #ccc;
      cursor: pointer;
      background: #eee;
    }
    .tabs button.active {
      background: #fff;
      border-bottom: none;
    }
    .tab-content {
      display: none;
      border: 1px solid #ccc;
      padding: 20px;
      background: #fff;
    }
    .tab-content.active {
      display: block;
    }

    .controls {
      margin-bottom: 20px;
    }

    .slider-container {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .slider-container input {
      flex: 1;
    }

    .print-area {
      text-align: center;
    }

    .page {
      background: #fff;
      border: 1px solid #000;
      box-sizing: border-box;
      margin: 20px auto;
      padding: 10px 15px;
      display: inline-block;
    }

    .bubbles {
      display: grid;
      grid-template-columns: repeat(10, auto);
      gap: 5px;
      margin-top: 20px;
    }
    .bubble {
      width: 20px;
      height: 20px;
      border: 1px solid #000;
      border-radius: 50%;
    }

    /* contador versão */
    .version {
      position: fixed;
      bottom: 10px;
      right: 10px;
      font-size: 12px;
      color: #666;
    }

    /* câmera */
    #camera-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
      gap: 10px;
    }
    video {
      border: 1px solid #000;
      max-width: 100%;
    }
    canvas {
      display: none;
    }
  </style>
</head>
<body>
  <div class="tabs">
    <button class="tab-button active" data-tab="tab1">Gabarito</button>
    <button class="tab-button" data-tab="tab2">Configurações</button>
  </div>

  <div id="tab1" class="tab-content active">
    <div class="controls">
      <button onclick="printCard()">Imprimir</button>
    </div>

    <div class="print-area" id="print-area">
      <div class="page">
        <h3>Cartão Resposta</h3>
        <div class="bubbles" id="bubbles"></div>
      </div>
    </div>

    <!-- câmera -->
    <div id="camera-container">
      <button onclick="startCamera()">Ativar Câmera</button>
      <video id="camera" autoplay playsinline></video>
      <button onclick="captureImage()">Escanear</button>
      <canvas id="snapshot"></canvas>
    </div>
  </div>

  <div id="tab2" class="tab-content">
    <div class="controls">
      <label for="bubbleSize">Tamanho das bolhas:</label>
      <div class="slider-container">
        <input type="range" id="bubbleSize" min="10" max="50" value="20">
        <span id="bubbleSizeValue">20</span><span>px</span>
      </div>
    </div>
  </div>

  <div class="version">v1.0</div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    // abas
    document.querySelectorAll('.tab-button').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });

    // gerar bolhas
    function generateBubbles(size = 20) {
      const bubblesContainer = document.getElementById('bubbles');
      bubblesContainer.innerHTML = '';
      for (let i = 0; i < 50; i++) {
        const bubble = document.createElement('div');
        bubble.className = 'bubble';
        bubble.style.width = size + 'px';
        bubble.style.height = size + 'px';
        bubblesContainer.appendChild(bubble);
      }
    }
    generateBubbles();

    // controle tamanho bolha
    const bubbleSizeInput = document.getElementById('bubbleSize');
    const bubbleSizeValue = document.getElementById('bubbleSizeValue');
    bubbleSizeInput.addEventListener('input', () => {
      bubbleSizeValue.textContent = bubbleSizeInput.value;
      generateBubbles(parseInt(bubbleSizeInput.value));
    });

    // imprimir apenas cartão
    function printCard() {
      const printContents = document.getElementById('print-area').innerHTML;
      const originalContents = document.body.innerHTML;
      document.body.innerHTML = printContents;
      window.print();
      document.body.innerHTML = originalContents;
      location.reload();
    }

    // câmera
    let stream;
    function startCamera() {
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(s => {
          stream = s;
          document.getElementById('camera').srcObject = stream;
        })
        .catch(err => alert("Erro ao acessar câmera: " + err));
    }

    function captureImage() {
      const video = document.getElementById('camera');
      const canvas = document.getElementById('snapshot');
      const ctx = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0);
      analyzeBubbles(canvas);
    }

    // análise simples (placeholder)
    function analyzeBubbles(canvas) {
      alert("Imagem capturada! Aqui entra a detecção de bolhas.");
      // depois implementamos a análise real
      // e geração dos resultados em planilha
    }

    // exportar Excel (placeholder)
    function exportToExcel(data) {
      const ws = XLSX.utils.json_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Respostas");
      XLSX.writeFile(wb, "respostas.xlsx");
    }
  </script>
</body>
</html>
